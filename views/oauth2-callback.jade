extends layout

block content
    ul
        li(class=(title === 'Step' ? 'active' : ''))
            a(href='/step') Step
        li(class=(title === 'Distance' ? 'active' : ''))
            a(href='/distance') Distance
        li(class=(title === 'CaloriesOut' ? 'active' : ''))
            a(href='/caloriesOut') CaloriesOut

    //a(class='button', href='/step') Step
    script(src='https://npmcdn.com/axios/dist/axios.min.js')
    script.

        function prepareParameters() {
            var d = new Date();
            var today = d.yyyymmdd();
            var params = document.location.href.split("#")[1].split("&");
            return {today: today, params: params};
        }

        function getActivityToday() {
            var p = prepareParameters();
        //function saveCrednetial(){
            var user_id = '';
            var token = '';

            var today = p.today;//add

            p.params.forEach(function (e) {
                if ((e.split("="))[0] == 'user_id') {
                    user_id = e.split("=")[1];
                }
                else if ((e.split("="))[0] == 'access_token') {
                    token = e.split("=")[1];
                }
            });
            
            //add
            axios.get('https://api.fitbit.com/1/user/' + user_id + '/activities/date/' + today + '.json',
                    {headers: {'Authorization': 'Bearer ' + token}})
                    .then(function (response) {
                        console.log('activities', response.data.activities);
                        console.log('goals', response.data.goals);
                    })
                    .catch(function (response) {
                        console.log(response);
                    });//add

            axios.post('/oauth2/saveCredentials',{token:token,user_id:user_id})
                    .then(function (response) {
                        console.log(response.data.message);
                    })
                    .catch(function (response) {
                        console.log(response);
                    });
        }

        //saveCrednetial();
        getActivityToday();//add